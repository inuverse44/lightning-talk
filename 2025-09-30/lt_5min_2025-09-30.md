---
marp: true
theme: default
size: 16:9
paginate: true
math: mathjax
header: '待ち行列理論で考えるGKEの最適なポッド数'
footer: 'Inuverse'
---

<!-- _class: lead -->

# 待ち行列理論で考えるGKEの最適なポッド数

## Inuverse

**エンジニアたちのゆるっと数学勉強会 #10**

---

## 自己紹介

![bg right:40% 85% fit](assets/inuverse.jpg) 

- Inuverse（いぬばーす）
- とある小売企業の2年目エンジニア
- API開発や負荷検証などを担当
- 趣味は物理学、宇宙が好きです

---

## 動機：最適なポッド数って？

負荷検証でGKEに大量のリクエストを送ったとき、ふと思いました。

**「SLOを満たすために、結局ポッドは何台あれば安心なんだろう？」**

感覚や経験だけでなく、何か理論的な裏付けで考えられないか？

<br>

➡️ **そこで、サービスの混雑を数学的に扱う「待ち行列理論」を使ってみることにしました。**

---

## アプローチ：M/M/c モデル

数ある待ち行列モデルの中から、最もシンプルで一般的な **M/M/c モデル** を採用します。

これは、ざっくり言うと...

- **M (Arrival):** リクエストが **ランダム** にやってくる
- **M (Service):** ポッドの処理時間も **ランダム** にばらつく
- **c (Servers):** 処理してくれるポッドが **c個** ある

という状況をモデル化したものです。

---

## 結果：SLOから必要なポッド数を見積もる

**SLOを「応答時間の95%ileが200ms以内」** と設定し、計算した結果がこちらです。

![w:800](https://storage.googleapis.com/zenn-user-upload/6ab263fd930e-20250711.png)

このグラフから、**リクエスト頻度(λ)** と **1ポッドあたりの処理能力(μ)** が分かれば、SLOを満たすために **必要なポッド数(c)** が何台かを理論的に見積もることができます。

---

## まとめ

- **待ち行列理論** を使うことで、GKEのポッド数のサイジングに理論的なアプローチができました。

- サービスの **負荷(λ)** と **処理能力(μ)** を計測すれば、SLOを満たす **ポッド数(c)** の目安がわかります。

- もう「なんとなく」でポッド数を決めるのはやめにしませんか？

---

<!-- _class: invert -->

# ご清聴ありがとうございました

## Q&A
